<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ÙƒØ´Ù Ø£Ø³Ø¹Ø§Ø± Ù„Ù…Ø¹Ø±Ø¶ Ø£Ø¨Ùˆ Ø±Ø§Ù…Ø²</title>
<style>
body { font-family: Arial; margin: 40px; padding: 20px; }
h1 { text-align:center; }
.search-box { text-align:center; margin-bottom:20px; }
input[type="text"] { padding:8px; font-size:16px; margin:5px; }
button { padding:8px 12px; font-size:16px; cursor:pointer; margin:5px; }
mark { background-color: yellow; }
table { border-collapse: collapse; width:100%; margin-top:20px; display:none; }
th, td { border:1px solid #333; padding:8px; text-align:right; }
th { background-color:#f2f2f2; }
.hidden { display:none; }
#resultCount { text-align:center; margin-top:10px; font-weight:bold; color:#444; }
#invoiceTable th, #invoiceTable td { text-align:right; }
#total { font-weight:bold; margin-top:10px; text-align:right; }
.qty-input { width:40px; text-align:center; }
.qtyCol, .actionCol { display:none; } /* Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„ÙƒÙ…ÙŠØ© ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù…Ø®ÙÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
</style>
</head>
<body>

<h1>ÙƒØ´Ù Ø£Ø³Ø¹Ø§Ø± Ù„Ù…Ø¹Ø±Ø¶ Ø£Ø¨Ùˆ Ø±Ø§Ù…Ø²</h1>

<div class="search-box">
<input type="text" id="searchInput" placeholder="Ø§ÙƒØ¨Ø³ Ù‡ÙˆÙ† ÙˆØ³ÙˆÙŠ Ø¨Ø­Ø« ğŸ”" disabled>
<div>
  <button id="searchBtn" disabled>Ø¨Ø­Ø«</button>
  <button id="clearBtn" disabled>Ù…Ø³Ø­ âœ–ï¸</button>
</div>
<div style="text-align:center; margin-bottom:20px;">
  <button id="createInvoiceBtn">Ø¥Ù†Ø´Ø§Ø¡ ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø© ğŸ’°</button>
</div>

<div id="invoiceSection" style="display:none;">
<h2 style="text-align:center;">Ø§Ù„ÙØ§ØªÙˆØ±Ø©</h2>
<table id="invoiceTable">
<thead>
<tr><th>Ø§Ù„ØµÙ†Ù</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr>
</thead>
<tbody></tbody>
</table>
<div id="total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0</div>
</div>

<p>
<div style="background-color:#1D70B8;color:white;padding:5px 15px;border-radius:5px;display:inline-block;box-shadow:1px 1px 4px rgba(0,0,0,0.2);">
<h4 style="margin:0;">ØªØµÙ…ÙŠÙ… ÙˆØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ø¨Ø±Ù…Ø¬ Ø±Ø§Ù…Ø² ğŸ’¯</h4>
</div>
</p>

<div id="resultCount"></div>

<div id="content">
<table id="priceTable">
<thead>
<tr>
<th>Ø±Ù‚Ù… Ø§Ù„ØµÙ†Ù</th>
<th>Ø§Ù„ØµÙ†Ù</th>
<th>Ø§Ù„Ø³Ø¹Ø±</th>
<th class="qtyCol">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
<th class="actionCol">Ø¥Ø¬Ø±Ø§Ø¡</th>
</tr>
</thead>
<tbody>
<tr><td>I00000001</td><td>ØºØ³Ø§Ù„Ø© Ø§Ù„ Ø¬ÙŠ 10.5 ÙƒÙŠÙ„Ùˆ Ø³Ù„ÙØ± LG V3</td><td>2520</td></tr>
<tr><td>I00000002</td><td>ØºØ³Ø§Ù„Ø© Ø§Ù„ Ø¬ÙŠ 9 ÙƒÙŠÙ„Ùˆ V4</td><td>2230</td></tr>
<tr><td>I00000003</td><td>ØºØ³Ø§Ù„Ø© Ù‡ÙŠØ± 10 ÙƒÙŠÙ„Ùˆ Ø³Ù„ÙØ± Ø¯Ø§ÙŠØ±ÙƒØª Ù…ÙˆØ´Ù† HW100-B14636NS3</td><td>1900</td></tr>
<tr><td>I00000004</td><td>ØºØ³Ø§Ù„Ø© Ù‡ÙŠØ± 10 ÙƒÙŠÙ„Ùˆ Ø¯Ø§ÙŠØ±ÙƒØª Ø¯Ø±Ø§ÙŠÙ HW120</td><td>2100</td></tr>
<tr><td>I00000005</td><td>ØºØ³Ø§Ù„Ø© Ø¬ÙŠÙ†Ø±Ø§Ù„ Ù„ÙˆÙƒØ³ 5 ÙƒÙŠÙ„Ùˆ Ø§Ø³ÙˆØ¯ GLX-682B</td><td>840</td></tr>
<tr><td>I00000006</td><td>ØºØ³Ø§Ù„Ø© Ù…Ù†Ø¬Ø± Ù‡ÙˆÙ… 9 ÙƒÙŠÙ„Ùˆ Ø³Ù„ÙØ±</td><td>1250</td></tr>
</tbody>
</table>
</div>

<script>
const invoiceSection = document.getElementById('invoiceSection');
const invoiceTable = document.getElementById('invoiceTable').querySelector('tbody');
const totalDiv = document.getElementById('total');
const createInvoiceBtn = document.getElementById('createInvoiceBtn');
const searchInput = document.getElementById('searchInput');
const searchBtn = document.getElementById('searchBtn');
const clearBtn = document.getElementById('clearBtn');
const resultCount = document.getElementById('resultCount');
const priceTable = document.getElementById('priceTable');
const priceTbody = priceTable.querySelector('tbody');

// ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙˆØªÙ…ÙƒÙŠÙ† Ø§Ù„Ø¨Ø­Ø« ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙˆØ£Ø¹Ù…Ø¯Ø© Ø§Ù„ÙƒÙ…ÙŠØ© ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡
createInvoiceBtn.addEventListener('click', () => {
  invoiceSection.style.display = 'block';
  searchInput.disabled = false;
  searchBtn.disabled = false;
  clearBtn.disabled = false;
  priceTable.style.display = 'table';

  // Ø¥Ø¸Ù‡Ø§Ø± Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„ÙƒÙ…ÙŠØ© ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡
  priceTable.querySelectorAll('.qtyCol').forEach(th => th.style.display = '');
  priceTable.querySelectorAll('.actionCol').forEach(th => th.style.display = '');
  
  Array.from(priceTbody.rows).forEach(row => {
    // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù…ÙˆØ¯ Ø§Ù„ÙƒÙ…ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯
    if(!row.querySelector('.qty-input')) {
      const qtyCell = row.insertCell(3);
      qtyCell.classList.add('qtyCol');
      const minusBtn = document.createElement('button');
      minusBtn.innerText = '-';
      const qtyInput = document.createElement('input');
      qtyInput.type = 'text';
      qtyInput.value = '1';
      qtyInput.readOnly = true;
      qtyInput.classList.add('qty-input');
      const plusBtn = document.createElement('button');
      plusBtn.innerText = '+';
      qtyCell.appendChild(minusBtn);
      qtyCell.appendChild(qtyInput);
      qtyCell.appendChild(plusBtn);

      minusBtn.addEventListener('click', () => {
        let val = parseInt(qtyInput.value);
        if(val>1) qtyInput.value = val-1;
      });
      plusBtn.addEventListener('click', () => {
        let val = parseInt(qtyInput.value);
        qtyInput.value = val+1;
      });
    }

    // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯
    if(!row.querySelector('.addBtn')) {
      const addCell = row.insertCell(4);
      addCell.classList.add('actionCol');
      const btn = document.createElement('button');
      btn.innerText = 'Ø¥Ø¶Ø§ÙØ© Ù„Ù„ÙØ§ØªÙˆØ±Ø©';
      btn.classList.add('addBtn');
      addCell.appendChild(btn);
      btn.addEventListener('click', () => addToInvoice(
        row.cells[1].innerText,
        parseFloat(row.cells[2].innerText),
        parseInt(row.cells[3].querySelector('input').value)
      ));
    }
  });
});

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
function updateTotal() {
  let sum = 0;
  Array.from(invoiceTable.rows).forEach(row => {
    const price = parseFloat(row.cells[1].innerText.replace(/,/g,'')) || 0;
    const qty = parseInt(row.cells[2].innerText) || 0;
    row.cells[3].innerText = (price * qty).toLocaleString();
    sum += price * qty;
  });
  totalDiv.innerText = `Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${sum.toLocaleString()}`;
}

// Ø¥Ø¶Ø§ÙØ© ØµÙ Ù„Ù„ÙØ§ØªÙˆØ±Ø©
function addToInvoice(name, price, qty) {
  const tr = document.createElement('tr');
  tr.innerHTML = `<td>${name}</td><td>${price}</td><td>${qty}</td><td>${price*qty}</td><td><button class="removeBtn">Ø­Ø°Ù</button></td>`;
  invoiceTable.appendChild(tr);
  updateTotal();

  tr.querySelector('.removeBtn').addEventListener('click', () => {
    tr.remove();
    updateTotal();
  });
}

// Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ
function smartSearch() {
  const input = searchInput.value.trim().toLowerCase();
  let matches = 0;
  Array.from(priceTbody.rows).forEach(row => {
    let rowText = row.cells[0].innerText + ' ' + row.cells[1].innerText + ' ' + row.cells[2].innerText;
    if(input === '' || input.split(/\s+/).every(word => rowText.toLowerCase().includes(word))) {
      row.classList.remove('hidden');
      matches++;
    } else {
      row.classList.add('hidden');
    }
  });
  resultCount.innerText = matches>0?`Ø¹Ø¯Ø¯ Ø§Ù„Ù†ØªØ§Ø¦Ø¬: ${matches}`:'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø© ğŸ˜•';
}

// Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø¨Ø­Ø«
searchInput.addEventListener('input', smartSearch);
searchBtn.addEventListener('click', smartSearch);
clearBtn.addEventListener('click', () => { searchInput.value=''; smartSearch(); });
</script>

</body>
</html>
