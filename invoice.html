<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>إنشاء فاتورة</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f5f5f5;
  margin: 40px;
  padding: 0;
}

/* عنوان الفاتورة */
.header {
  background-color: #850000;
  color: white;
  text-align: center;
  padding: 15px 0;
  font-size: 22px;
  border-radius: 6px;
  margin-bottom: 20px;
}

/* الأزرار الرئيسية */
.main-buttons {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
  margin-bottom: 25px;
}

button {
  padding: 10px 25px;
  font-size: 16px;
  background-color: #1D70B8;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: 0.2s;
}

button:hover {
  background-color: #155a8a;
}

/* حقل البحث */
.search-box {
  text-align: center;
  margin-bottom: 20px;
  display: none;
}

.search-box input {
  padding: 8px;
  font-size: 15px;
  width: 60%;
  border: 1px solid #ccc;
  border-radius: 5px;
}

/* جدول المنتجات */
table {
  border-collapse: collapse;
  width: 100%;
  margin-top: 10px;
  display: none;
}

th, td {
  border: 1px solid #ccc;
  padding: 8px;
  text-align: center;
}

th {
  background-color: #eee;
}

/* جدول الفاتورة */
#invoiceTable {
  margin-top: 30px;
  width: 100%;
  display: none;
}

/* تنسيق أزرار الكمية */
.qty-control {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 5px;
}

.qty-control button {
  width: 28px;
  height: 28px;
  font-size: 16px;
  font-weight: bold;
  border: none;
  background-color: #1D70B8;
  color: white;
  border-radius: 5px;
  cursor: pointer;
  transition: 0.2s;
}

.qty-control button:hover {
  background-color: #155a8a;
}

.qty-input {
  width: 35px;
  height: 28px;
  text-align: center;
  font-size: 16px;
  border: 1px solid #ccc;
  border-radius: 5px;
}

/* الإجمالي */
.total-box {
  background-color: #850000;
  color: white;
  text-align: center;
  font-size: 20px;
  padding: 10px;
  width: 300px;
  margin: 25px auto;
  border-radius: 8px;
  display: none;
}
</style>
</head>
<body>

<div class="header">إنشاء فاتورة</div>

<div class="main-buttons">
  <button id="newInvoiceBtn">إنشاء فاتورة جديدة</button>
  <button onclick="window.location.href='https://ramezatatra9.github.io/ramez/product.html'">الذهاب إلى المنتجات</button>
</div>

<div class="search-box" id="searchBox">
  <input type="text" id="searchInput" placeholder="ابحث عن منتج...">
</div>

<table id="productTable">
  <thead>
    <tr>
      <th>الاسم</th>
      <th>السعر</th>
      <th>الإجراء</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<!-- جدول الفاتورة -->
<table id="invoiceTable">
  <thead>
    <tr>
      <th>اسم المنتج</th>
      <th>السعر</th>
      <th>الكمية</th>
      <th>الإجمالي</th>
      <th>حذف</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div class="total-box" id="totalBox">الإجمالي: 0</div>

<script>
document.getElementById("newInvoiceBtn").addEventListener("click", async () => {
  document.getElementById("searchBox").style.display = "block";
  document.getElementById("productTable").style.display = "table";
  document.getElementById("invoiceTable").style.display = "table";
  document.getElementById("totalBox").style.display = "block";

  const response = await fetch('https://ramezatatra9.github.io/ramez/product.html');
  const text = await response.text();
  const parser = new DOMParser();
  const doc = parser.parseFromString(text, 'text/html');
  const rows = doc.querySelectorAll('#productTable tbody tr');
  
  const tableBody = document.querySelector('#productTable tbody');
  tableBody.innerHTML = '';

  rows.forEach(row => {
    const cells = row.querySelectorAll('td');
    if (cells.length >= 2) {
      const name = cells[0].textContent.trim();
      const price = cells[1].textContent.trim();
      const newRow = document.createElement('tr');
      newRow.innerHTML = `
        <td>${name}</td>
        <td>${price}</td>
        <td><button class="add-btn">إضافة</button></td>
      `;
      tableBody.appendChild(newRow);
    }
  });

  setupFunctions();
});

function setupFunctions() {
  const searchInput = document.getElementById("searchInput");
  const rows = document.querySelectorAll("#productTable tbody tr");
  
  searchInput.addEventListener("input", () => {
    const val = searchInput.value.toLowerCase();
    rows.forEach(r => {
      const text = r.textContent.toLowerCase();
      r.style.display = text.includes(val) ? "" : "none";
    });
  });

  const addBtns = document.querySelectorAll(".add-btn");
  addBtns.forEach(btn => {
    btn.addEventListener("click", e => {
      const row = e.target.closest("tr");
      const name = row.cells[0].textContent;
      const price = parseFloat(row.cells[1].textContent);
      addToInvoice(name, price);
    });
  });
}

function addToInvoice(name, price) {
  const table = document.querySelector("#invoiceTable tbody");
  const row = document.createElement("tr");

  const nameCell = row.insertCell();
  nameCell.textContent = name;

  const priceCell = row.insertCell();
  priceCell.textContent = price;

  const qtyCell = row.insertCell();
  const qtyDiv = document.createElement('div');
  qtyDiv.classList.add('qty-control');

  const minusBtn = document.createElement('button');
  minusBtn.innerText = '-';

  const qtyInput = document.createElement('input');
  qtyInput.type = 'text';
  qtyInput.value = '1';
  qtyInput.readOnly = true;
  qtyInput.classList.add('qty-input');

  const plusBtn = document.createElement('button');
  plusBtn.innerText = '+';

  qtyDiv.appendChild(minusBtn);
  qtyDiv.appendChild(qtyInput);
  qtyDiv.appendChild(plusBtn);
  qtyCell.appendChild(qtyDiv);

  const totalCell = row.insertCell();
  totalCell.textContent = price;

  const delCell = row.insertCell();
  const delBtn = document.createElement('button');
  delBtn.textContent = 'حذف';
  delCell.appendChild(delBtn);

  table.appendChild(row);
  updateTotal();

  minusBtn.addEventListener('click', () => {
    let val = parseInt(qtyInput.value);
    if (val > 1) qtyInput.value = val - 1;
    totalCell.textContent = price * qtyInput.value;
    updateTotal();
  });

  plusBtn.addEventListener('click', () => {
    qtyInput.value = parseInt(qtyInput.value) + 1;
    totalCell.textContent = price * qtyInput.value;
    updateTotal();
  });

  delBtn.addEventListener('click', () => {
    row.remove();
    updateTotal();
  });
}

function updateTotal() {
  const totals = document.querySelectorAll("#invoiceTable tbody tr td:nth-child(4)");
  let sum = 0;
  totals.forEach(cell => sum += parseFloat(cell.textContent) || 0);
  document.getElementById("totalBox").textContent = `الإجمالي: ${sum.toFixed(2)}`;
}
</script>
</body>
</html>
