<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ุฅูุดุงุก ูุงุชูุฑุฉ</title>
<style>
body { 
  font-family: Arial; 
  margin: 40px 80px; /* ุฒูุงุฏุฉ ุงููุณุงูุฉ ูู ุงูุฃุนูู ูุงูุฃุณูู 40px ููู ุงููููู ูุงููุณุงุฑ 80px */
  padding: 20px; 
  box-sizing: border-box; /* ูุถูุงู ุนุฏู ุชุฌุงูุฒ ุงููุญุชูู ูููุณุงุญุฉ */
}
#invoiceContainer, #invoiceSummaryContainer {
  margin-left: auto;
  margin-right: auto; /* ูุฌุนููุง ูุฑูุฒุฉ ุฃูููุงู */
  max-width: 1200px; /* ุนุฑุถ ุฃูุตู ูููุงุฌูุฉ */
}
button { min-width:180px; }
table { border-collapse: collapse; width:100%; max-width:100%; }
</style>

</head>
<body>

<!-- ูุณุชุทูู ุนููุงู ุงููุงุชูุฑุฉ -->
<div style="background-color:#2121FF; color:white; text-align:center; padding:15px 0; margin-bottom:20px;">
  <h1>ุฅูุดุงุก ูุงุชูุฑุฉ ๐ฐ</h1>
</div>

<!-- ุฃุฒุฑุงุฑ ุงูุงูุชูุงู ูุฅูุดุงุก ุงููุงุชูุฑุฉ -->
<div style="text-align:center; margin-bottom:30px;">
  <button id="goProductsBtn" style="display:block; margin:10px auto;">ุงุฐูุจ ุฅูู ุตูุญุฉ ุงูููุชุฌุงุช</button>
  <button id="createInvoiceBtn" style="display:block; margin:10px auto;">ุฅูุดุงุก ูุงุชูุฑุฉ ุฌุฏูุฏุฉ ๐ฐ</button>
</div>
<th>   ููุง ุจุฏู ุชุณูู ูุงุชูุฑุฉ ูุชุดูู ูู ุจุชุทูุน ุนููู ูููุง ุจุชุถุบุท ุนูู ุฒุฑ ุงูุดุงุก ูุงุชูุฑุฉ ุฌุฏูุฏุฉ . . . ุจุนุฏูุง ุณูู ุจุญุซ ุน ุงูุตูู ุงูู ุจุฏู ุงูุงู ูุณูู ุงุถุงูุฉ ูููุงุชูุฑุฉ
</th>
<!-- ุฌุฏูู ุงูููุชุฌุงุช ุงููุถุงูุฉ ูููุงุชูุฑุฉ -->
<div id="invoiceSummaryContainer">
  <h2 style="text-align:center;">ุงูููุชุฌุงุช ุงููุถุงูุฉ ูููุงุชูุฑุฉ</h2>
  <table id="invoiceSummaryTable" style="width:100%; border-collapse: collapse;">
    <thead>
      <tr>
        <th>ุงูุตูู</th>
        <th>ุงูุณุนุฑ</th>
        <th>ุงููููุฉ</th>
        <th>ุงูุฅุฌูุงูู</th>
        <th>ุฅุฌุฑุงุก</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>
<div id="total"></div>

<!-- ุฌุฏูู ุงูููุชุฌุงุช ููุจุญุซ ูุงูุฅุถุงูุฉ -->
<div id="invoiceContainer"></div>

<script>
const createInvoiceBtn = document.getElementById('createInvoiceBtn');
const goProductsBtn = document.getElementById('goProductsBtn');
const invoiceContainer = document.getElementById('invoiceContainer');
const invoiceSummaryContainer = document.getElementById('invoiceSummaryContainer');
const invoiceSummaryTable = document.getElementById('invoiceSummaryTable').querySelector('tbody');
const totalDiv = document.getElementById('total');
let invoiceTable;
let precomputedText = [];

// --- ุฒุฑ ุงูุงูุชูุงู ููููุชุฌุงุช ---
goProductsBtn.addEventListener('click', () => {
  window.location.href = 'https://ramezatatra9.github.io/ramez/Ramez_ramez_ramez_423992403_423992403_423992403_0595979592_0595979592_0595979592_99199_99199_99199.html';
});

// --- ุฏุงูุฉ debounce ูุชุฃุฎูุฑ ุงูุจุญุซ ---
function debounce(func, delay) {
  let timeout;
  return function(...args){
    clearTimeout(timeout);
    timeout = setTimeout(()=> func.apply(this,args), delay);
  }
}

// --- ุฅูุดุงุก ุงููุงุชูุฑุฉ ูุฌูุจ ุฌุฏูู ุงูููุชุฌุงุช ---
createInvoiceBtn.addEventListener('click', async () => {
  if(invoiceContainer.innerHTML.trim() === '') {
    try {
      const response = await fetch('https://ramezatatra9.github.io/ramez/product.html');
      if(!response.ok) throw new Error('ุชุนุฐุฑ ุฌูุจ ุตูุญุฉ ุงูููุชุฌุงุช');
      const html = await response.text();

      const tempDiv = document.createElement('div');
      tempDiv.innerHTML = html;
      invoiceTable = tempDiv.querySelector('#priceTable');
      if(!invoiceTable) throw new Error('ุงูุฌุฏูู ุบูุฑ ููุฌูุฏ ูู product.html');

      invoiceContainer.appendChild(invoiceTable);
      invoiceContainer.style.display = 'block';
      invoiceSummaryContainer.style.display = 'block';

      setupInvoiceFunctions();

    } catch(err) {
      invoiceContainer.innerHTML = `<p style="color:red; text-align:center;">ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฌูุจ ุงูุตูุญุฉ: ${err.message}</p>`;
    }
  } else {
    invoiceContainer.style.display = 'block';
    invoiceSummaryContainer.style.display = 'block';
  }
});

// --- ุฅุนุฏุงุฏ ูุธุงุฆู ุงูุฌุฏูู --- 
function setupInvoiceFunctions(){
  const invoiceBody = invoiceTable.querySelector('tbody');
  const rows = Array.from(invoiceBody.rows);

  // ุฅูุดุงุก ุฃุนูุฏุฉ ุงููููุฉ ูุฒุฑ ุงูุฅุถุงูุฉ ูุฑุฉ ูุงุญุฏุฉ
  rows.forEach(row=>{
    if(!row.querySelector('.qty-input')){
      const qtyCell = row.insertCell(-1);
      const minusBtn = document.createElement('button'); minusBtn.innerText='-';
      const qtyInput = document.createElement('input'); qtyInput.type='text'; qtyInput.value='1';
      qtyInput.readOnly=true; qtyInput.classList.add('qty-input');
      const plusBtn = document.createElement('button'); plusBtn.innerText='+';
      qtyCell.appendChild(minusBtn); qtyCell.appendChild(qtyInput); qtyCell.appendChild(plusBtn);

      minusBtn.addEventListener('click',()=>{ if(parseInt(qtyInput.value)>1) qtyInput.value--; });
      plusBtn.addEventListener('click',()=>{ qtyInput.value = parseInt(qtyInput.value)+1; });
    }

    if(!row.querySelector('.addBtn')){
      const addCell = row.insertCell(-1);
      const addBtn = document.createElement('button');
      addBtn.innerText='ุฅุถุงูุฉ ูููุงุชูุฑุฉ'; addBtn.classList.add('addBtn'); addCell.appendChild(addBtn);
      addBtn.addEventListener('click', ()=>{
        const name = row.cells[1].innerText;
        const price = parseFloat(row.cells[2].innerText.replace(/,/g,''))||0;
        const qty = parseInt(row.querySelector('.qty-input').value);
        addToInvoice(name, price, qty);
      });
    }
  });

  // --- ุฅุนุฏุงุฏ ุงูุจุญุซ ---
  const searchInput = document.createElement('input');
  searchInput.type='text'; searchInput.placeholder='ุงุจุญุซ ุนู ุงูุตูู ๐';
  searchInput.style.display='block';
  searchInput.style.margin='10px auto';
  searchInput.style.width='60%';
  invoiceContainer.prepend(searchInput);
  const resultCount = document.createElement('div'); resultCount.id='resultCount';
  resultCount.style.textAlign='center';
  invoiceContainer.prepend(resultCount);

  // ุญูุธ ูุตูุต ุงูุตููู ูุณุจูุงู
  precomputedText = rows.map(row=>Array.from(row.cells).map(td=>td.innerText.toLowerCase()).join(' '));

  // ุงูุจุญุซ ุงูุณุฑูุน ูุน debounce
  searchInput.addEventListener('input', debounce(()=>{
    let matches = 0;
    rows.forEach((row,i)=>{
      if(searchInput.value.trim() === '' || searchInput.value.toLowerCase().split(/\s+/).every(w=>precomputedText[i].includes(w))){
        row.style.display=''; matches++;
      } else row.style.display='none';
    });
    resultCount.innerText = matches>0?`ุนุฏุฏ ุงููุชุงุฆุฌ: ${matches}`:'ูุง ุชูุฌุฏ ูุชุงุฆุฌ ูุทุงุจูุฉ ๐';
  }, 200));
}

// --- ุฅุถุงูุฉ ูููุงุชูุฑุฉ ---
function addToInvoice(name, price, qty){
  const tr = document.createElement('tr');
  tr.innerHTML = `<td>${name}</td><td>${price}</td><td>${qty}</td><td>${(price*qty).toLocaleString()}</td>
                  <td><button class="removeBtn">ุญุฐู</button></td>`;
  invoiceSummaryTable.appendChild(tr);

  // ุชูุนูู ุฒุฑ ุงูุญุฐู
  tr.querySelector('.removeBtn').addEventListener('click', ()=>{
    tr.remove();
    updateTotal();
  });

  updateTotal();
}

// --- ุชุญุฏูุซ ุงูุฅุฌูุงูู ---
function updateTotal(){
  let total = 0;
  Array.from(invoiceSummaryTable.rows).forEach(row=>{
    total += parseFloat(row.cells[3].innerText.replace(/,/g,'')) || 0;
  });
  totalDiv.innerText = `ุงูุฅุฌูุงูู: ${total.toLocaleString()}`;
}
</script>

</body>
</html>
