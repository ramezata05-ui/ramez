<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¥Ù†Ø´Ø§Ø¡ ÙØ§ØªÙˆØ±Ø©</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f5f5f5;
  margin: 40px;
  padding: 0;
}

/* Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙØ§ØªÙˆØ±Ø© */
.header {
  background-color: #850000;
  color: white;
  text-align: center;
  padding: 15px 0;
  font-size: 22px;
  border-radius: 6px;
  margin-bottom: 20px;
}

/* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
.main-buttons {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
  margin-bottom: 25px;
}

button {
  padding: 10px 25px;
  font-size: 16px;
  background-color: #1D70B8;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: 0.2s;
}

button:hover {
  background-color: #155a8a;
}

/* Ø­Ù‚Ù„ Ø§Ù„Ø¨Ø­Ø« */
.search-box {
  text-align: center;
  margin-bottom: 20px;
  display: none;
}

.search-box input {
  padding: 8px;
  font-size: 15px;
  width: 60%;
  border: 1px solid #ccc;
  border-radius: 5px;
}

/* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
table {
  border-collapse: collapse;
  width: 100%;
  margin-top: 10px;
  display: none;
}

th, td {
  border: 1px solid #ccc;
  padding: 8px;
  text-align: center;
}

th {
  background-color: #eee;
}

/* Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© */
#invoiceTable {
  margin-top: 30px;
  width: 100%;
  display: none;
}

/* ØªÙ†Ø³ÙŠÙ‚ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙƒÙ…ÙŠØ© */
.qty-control {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 5px;
}

.qty-control button {
  width: 28px;
  height: 28px;
  font-size: 16px;
  font-weight: bold;
  border: none;
  background-color: #1D70B8;
  color: white;
  border-radius: 5px;
  cursor: pointer;
  transition: 0.2s;
}

.qty-control button:hover {
  background-color: #155a8a;
}

.qty-input {
  width: 35px;
  height: 28px;
  text-align: center;
  font-size: 16px;
  border: 1px solid #ccc;
  border-radius: 5px;
}

/* Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ */
.total-box {
  background-color: #850000;
  color: white;
  text-align: center;
  font-size: 20px;
  padding: 10px;
  width: 300px;
  margin: 25px auto 10px auto;
  border-radius: 8px;
  display: none;
}

/* Ø­Ù‚Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ„ */
.customer-box {
  display: none;
  text-align: center;
  margin: 20px auto;
}

.customer-box input {
  padding: 8px;
  width: 60%;
  font-size: 16px;
  border-radius: 6px;
  border: 1px solid #ccc;
}

/* Ø²Ø± PDF */
.pdf-btn {
  display: none;
  background-color: #008000;
  padding: 10px 20px;
  border-radius: 6px;
  margin: 10px auto;
  display: block;
}
</style>
</head>
<body>

<div class="header">Ø¥Ù†Ø´Ø§Ø¡ ÙØ§ØªÙˆØ±Ø©</div>

<div class="main-buttons">
  <button id="newInvoiceBtn">Ø¥Ù†Ø´Ø§Ø¡ ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
  <button onclick="window.location.href='https://ramezatatra9.github.io/ramez/product.html'">Ø§Ù„Ø°Ù‡Ø§Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
</div>

<div class="search-box" id="searchBox">
  <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬...">
</div>

<table id="productTable">
  <thead>
    <tr>
      <th>Ø§Ù„Ø§Ø³Ù…</th>
      <th>Ø§Ù„Ø³Ø¹Ø±</th>
      <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
<table id="invoiceTable">
  <thead>
    <tr>
      <th>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</th>
      <th>Ø§Ù„Ø³Ø¹Ø±</th>
      <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
      <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
      <th>Ø­Ø°Ù</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div class="total-box" id="totalBox">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0</div>

<!-- Ø­Ù‚Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
<div class="customer-box" id="customerBox">
  <input type="text" id="customerName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
</div>

<button id="savePdfBtn" class="pdf-btn">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙƒÙ…Ù„Ù PDF</button>

<!-- Ù…ÙƒØªØ¨Ø© html2pdf -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script>
document.getElementById("newInvoiceBtn").addEventListener("click", async () => {
  document.getElementById("searchBox").style.display = "block";
  document.getElementById("productTable").style.display = "table";
  document.getElementById("invoiceTable").style.display = "table";
  document.getElementById("totalBox").style.display = "block";
  document.getElementById("customerBox").style.display = "block";
  document.getElementById("savePdfBtn").style.display = "block";

  const response = await fetch('https://ramezatatra9.github.io/ramez/product.html');
  const text = await response.text();
  const parser = new DOMParser();
  const doc = parser.parseFromString(text, 'text/html');
  const rows = doc.querySelectorAll('#priceTable tbody tr, #productTable tbody tr');
  
  const tableBody = document.querySelector('#productTable tbody');
  tableBody.innerHTML = '';

  rows.forEach(row => {
    const cells = row.querySelectorAll('td');
    if (cells.length >= 2) {
      const name = cells[1]?.textContent?.trim() || cells[0].textContent.trim();
      const price = cells[2]?.textContent?.trim() || cells[1].textContent.trim();
      const newRow = document.createElement('tr');
      newRow.innerHTML = `
        <td>${name}</td>
        <td>${price}</td>
        <td><button class="add-btn">Ø¥Ø¶Ø§ÙØ©</button></td>
      `;
      tableBody.appendChild(newRow);
    }
  });

  setupFunctions();
});

function setupFunctions() {
  const searchInput = document.getElementById("searchInput");
  const rows = document.querySelectorAll("#productTable tbody tr");
  
  searchInput.addEventListener("input", () => {
    const val = searchInput.value.toLowerCase();
    rows.forEach(r => {
      const text = r.textContent.toLowerCase();
      r.style.display = text.includes(val) ? "" : "none";
    });
  });

  const addBtns = document.querySelectorAll(".add-btn");
  addBtns.forEach(btn => {
    btn.addEventListener("click", e => {
      const row = e.target.closest("tr");
      const name = row.cells[0].textContent;
      const price = parseFloat(row.cells[1].textContent.replace(/,/g, ""));
      addToInvoice(name, price);
    });
  });
}

function addToInvoice(name, price) {
  const table = document.querySelector("#invoiceTable tbody");
  const row = document.createElement("tr");

  const nameCell = row.insertCell();
  nameCell.textContent = name;

  const priceCell = row.insertCell();
  priceCell.textContent = price;

  const qtyCell = row.insertCell();
  const qtyDiv = document.createElement('div');
  qtyDiv.classList.add('qty-control');

  const minusBtn = document.createElement('button');
  minusBtn.innerText = '-';

  const qtyInput = document.createElement('input');
  qtyInput.type = 'text';
  qtyInput.value = '1';
  qtyInput.readOnly = true;
  qtyInput.classList.add('qty-input');

  const plusBtn = document.createElement('button');
  plusBtn.innerText = '+';

  qtyDiv.appendChild(minusBtn);
  qtyDiv.appendChild(qtyInput);
  qtyDiv.appendChild(plusBtn);
  qtyCell.appendChild(qtyDiv);

  const totalCell = row.insertCell();
  totalCell.textContent = price;

  const delCell = row.insertCell();
  const delBtn = document.createElement('button');
  delBtn.textContent = 'Ø­Ø°Ù';
  delCell.appendChild(delBtn);

  table.appendChild(row);
  updateTotal();

  minusBtn.addEventListener('click', () => {
    let val = parseInt(qtyInput.value);
    if (val > 1) qtyInput.value = val - 1;
    totalCell.textContent = price * qtyInput.value;
    updateTotal();
  });

  plusBtn.addEventListener('click', () => {
    qtyInput.value = parseInt(qtyInput.value) + 1;
    totalCell.textContent = price * qtyInput.value;
    updateTotal();
  });

  delBtn.addEventListener('click', () => {
    row.remove();
    updateTotal();
  });
}

function updateTotal() {
  const totals = document.querySelectorAll("#invoiceTable tbody tr td:nth-child(4)");
  let sum = 0;
  totals.forEach(cell => sum += parseFloat(cell.textContent) || 0);
  document.getElementById("totalBox").textContent = `Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${sum.toFixed(2)}`;
}

// Ø­ÙØ¸ PDF Ù…Ø¹ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª
document.getElementById("savePdfBtn").addEventListener("click", () => {
  const customerName = document.getElementById("customerName").value || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
  const now = new Date();
  const dateTime = now.toLocaleString('ar-EG');
  const element = document.createElement("div");

  element.innerHTML = `
    <h2 style="text-align:center;">ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h2>
    <p style="text-align:center;">Ø§Ù„Ø¹Ù…ÙŠÙ„: <strong>${customerName}</strong></p>
    <p style="text-align:center;">Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª: <strong>${dateTime}</strong></p>
    ${document.querySelector("#invoiceTable").outerHTML}
    <h3 style="text-align:center; color:#850000;">${document.getElementById("totalBox").textContent}</h3>
  `;

  const fileName = `ÙØ§ØªÙˆØ±Ø©_${now.getFullYear()}-${now.getMonth()+1}-${now.getDate()}_${now.getHours()}-${now.getMinutes()}.pdf`;
  html2pdf().set({ filename: fileName }).from(element).save();
});
</script>
</body>
</html>
